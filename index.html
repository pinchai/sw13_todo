<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam Tab Monitoring</title>

  <style>

      body {
          padding: 20px;
          font-family: Arial, sans-serif;
          background-color: #f4f6f8;

          -webkit-user-select: none; /* Safari / Chrome */
          -moz-user-select: none; /* Firefox */
          -ms-user-select: none; /* Old Edge */
          user-select: none; /* Standard */
      }

      .box {
          width: 200px;
          height: 120px;
          margin: 15px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          background-color: white;
          border: 2px solid #333;
          border-radius: 12px;
      }

      /* hide content */
      body.hidden {
          visibility: hidden;
          pointer-events: none;
      }

      /* warning overlay */
      #warning {
          display: none;
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.75);
          color: white;
          font-size: 22px;
          align-items: center;
          justify-content: center;
          text-align: center;
          z-index: 9999;
      }

      #warning.show {
          display: flex;
      }
  </style>
</head>

<body>

<div class="box"><h3>Coca</h3></div>
<div class="box"><h3>Sting</h3></div>
<div class="box"><h3>Coca</h3></div>

<div id="warning">
  ⚠️ Warning! <br><br>
  ប្អូនបានដើរចេញពីកន្លែងប្រឡងហើយ"<br>
  Violations: <span id="count">0</span>
</div>

<script>
    let violations = 0;
    let alreadyHidden = false;

    function addViolation() {
        violations++;
        document.getElementById("count").innerText = violations;
        document.getElementById("warning").classList.add("show");

        setTimeout(() => {
            document.getElementById("warning").classList.remove("show");
        }, 5000);
    }

    // 1️⃣ Tab switch / minimize
    document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
            document.body.classList.add("hidden");
            alreadyHidden = true;
        } else if (alreadyHidden) {
            document.body.classList.remove("hidden");
            addViolation();
            alreadyHidden = false;
        }
    });

    // 2️⃣ Mouse leaves browser window
    document.addEventListener("mouseleave", (e) => {
        if (e.clientY <= 0 || e.clientX <= 0) {
            addViolation();
        }
    });

    // 3️⃣ Window loses focus (Alt+Tab, click outside)
    window.addEventListener("blur", () => {
        document.body.classList.add("hidden");
        alreadyHidden = true;
    });

    window.addEventListener("focus", () => {
        if (alreadyHidden) {
            document.body.classList.remove("hidden");
            addViolation();
            alreadyHidden = false;
        }
    });

    document.addEventListener("contextmenu", (e) => {
        e.preventDefault();
    });

    document.addEventListener("dblclick", (e) => {
        e.preventDefault();
    });

    document.addEventListener("keydown", function (e) {

        const key = e.key.toLowerCase();
        console.log(key);

        // -------- DevTools --------
        if (e.key === "F12") {
            e.preventDefault();
            return false;
        }

    });
</script>

</body>
</html>
